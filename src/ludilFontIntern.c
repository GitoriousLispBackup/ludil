#include <ctype.h>
#include <consoleFont.h>
#include <string.h>
#include <SDL/SDL.h>

#define g_charWidth  5
#define g_charHeight  7

typedef struct 
{
  rectangle_t   *rectanglePtr;
  int            charOffset;
} posInd_t;


static char g_nullChar [g_charHeight] [g_charWidth] = 
{
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
};

static char g_numericChars [] [g_charHeight] [g_charWidth] = 
{
    {
        /* 0 */
        {0, 1, 1, 1, 0},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
        {0, 1, 1, 1, 0},
    },
    {
        /* 1 */
        {0, 0, 1, 0, 0},
        {0, 1, 1, 0, 0},
        {1, 0, 1, 0, 0},
        {0, 1, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 1, 1, 1, 0},
    },
    {
        /* 2 */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 1, 1, 1, 1},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 1, 1, 1, 1},
    },
    {
        /* 3 */
        {1, 1, 1, 1, 0},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 1, 1, 1, 0},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {1, 1, 1, 1, 0},
    },
    {
        /* 4 */
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
    },
    {
        /* 5 */
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 1, 1, 1, 0},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {1, 1, 1, 1, 1},
    },
    {
        /* 6 */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 0},
    },
    {
        /* 7 */
        {1, 1, 1, 1, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 1, 1},
        {0, 0, 0, 1, 0},
        {0, 0, 1, 1, 0},
        {0, 1, 1, 0, 0},
        {0, 1, 0, 0, 0},
    },
    {
        /* 8 */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {0, 1, 1, 1, 0},
    },
    {
        /* 9 */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 1, 1, 1, 0},
    },
    {
        /* : */
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 1, 1, 0, 0},
        {0, 1, 1, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 1, 1, 0, 0},
        {0, 1, 1, 0, 0},
    },
    {
        /* ; */
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 1, 0, 0, 0},
    },
    {
        /* < */
        {0, 0, 0, 1, 0},
        {0, 0, 1, 0, 0},
        {0, 1, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {0, 1, 0, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 0, 1, 0},
    },
    {
        /* = */
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {1, 1, 1, 1, 1},
        {0, 0, 0, 0, 0},
        {1, 1, 1, 1, 1},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
    },
    {
        /* > */
        {0, 1, 0, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 1, 0},
        {0, 0, 1, 0, 0},
        {0, 1, 0, 0, 0},
    },
    {
        /* ? */
        {0, 1, 1, 0, 0},
        {1, 0, 0, 1, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* @ */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 0, 1},
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {0, 1, 1, 0, 0},
    }
};

static char g_alphaChars [] [g_charHeight] [g_charWidth] =
{
    {
        /* A */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
    },
    {
        /* B */
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 0},
    },
    {
        /* C */
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 1, 1, 1, 0},
    },
    {
        /* D */
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 0},
    },
    {
        /* E */
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 1, 1, 1, 0},
    },
    {
        /* F */
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 1, 1, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
    },
    {
        /* G */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 1, 1, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {0, 1, 1, 1, 0},
    },
    {
        /* H */
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
    },
    {
        /* I */
        {0, 0, 0, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* J */
        {0, 1, 1, 1, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 1, 0},
        {1, 1, 1, 0, 0},
    },
    {
        /* K */
        {1, 0, 0, 1, 0},
        {1, 0, 0, 1, 0},
        {1, 0, 1, 0, 0},
        {1, 1, 1, 0, 0},
        {1, 0, 1, 0, 0},
        {1, 0, 0, 1, 0},
        {1, 0, 0, 1, 0},
    },
    {
        /* L */
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 1, 1, 1, 0},
    },
    {
        /* M */
        {1, 0, 0, 0, 1},
        {1, 1, 0, 1, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
    },
    {
        /* N */
        {1, 0, 0, 0, 1},
        {1, 1, 0, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 0, 1, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
    },
    {
        /* O */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {0, 1, 1, 1, 0},
    },
    {
        /* P */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
    },
    {
        /* Q */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 0, 1, 1},
        {0, 1, 1, 1, 0},
    },
    {
        /* R */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 1, 1, 0},
        {1, 0, 0, 1, 0},
        {1, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
    },
    {
        /* S */
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {0, 1, 1, 1, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 1, 1, 1, 0},
    },
    {
        /* T */
        {1, 1, 1, 1, 1},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* U */
        {1, 1, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {0, 1, 1, 1, 0},
    },
    {
        /* V */
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {0, 1, 0, 1, 0},
        {0, 1, 0, 1, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* W */
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 1, 0, 1},
        {0, 1, 0, 1, 0},
        {0, 1, 0, 1, 0},
    },
    {
        /* X */
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 1, 0, 1, 1},
        {0, 0, 1, 0, 0},
        {0, 1, 1, 1, 0},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
    },
    {
        /* Y */
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1},
        {0, 1, 0, 1, 0},
        {0, 1, 1, 1, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* Z */
        {1, 1, 1, 1, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 1, 0},
        {0, 0, 1, 1, 0},
        {0, 1, 1, 0, 0},
        {1, 1, 0, 0, 0},
        {1, 1, 1, 1, 1},
    }
};

static char g_symbolicChars [] [g_charHeight] [g_charWidth] = 
{
    {
        /* ! */
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* " */
        {0, 1, 0, 1, 0},
        {0, 1, 0, 1, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
    },
    {
        /* # */
        {0, 1, 0, 1, 0},
        {0, 1, 0, 1, 0},
        {1, 1, 1, 1, 1},
        {0, 1, 0, 1, 0},
        {1, 1, 1, 1, 1},
        {0, 1, 0, 1, 0},
        {0, 1, 0, 1, 0},
    },
    {
        /* $ */
        {0, 0, 1, 0, 0},
        {0, 1, 1, 1, 1},
        {1, 0, 1, 0, 0},
        {0, 1, 1, 1, 0},
        {0, 0, 1, 0, 1},
        {1, 1, 1, 1, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* % */
        {0, 1, 0, 0, 1},
        {1, 0, 1, 0, 1},
        {0, 1, 0, 1, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 1, 0, 1, 1},
        {1, 0, 0, 1, 1},
    },
    {
        /* & */
        {0, 1, 1, 0, 0},
        {1, 0, 0, 1, 0},
        {1, 0, 0, 1, 0},
        {0, 1, 0, 1, 0},
        {0, 0, 1, 0, 0},
        {0, 1, 0, 1, 0},
        {0, 0, 1, 0, 1},
    },
    {
        /* ' */
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
    },
    {
        /* ( */
        {0, 0, 0, 0, 0},
        {0, 1, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {0, 1, 0, 0, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* ) */
        {0, 0, 1, 0, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 1, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* * */
        {0, 0, 0, 0, 0},
        {1, 0, 0, 0, 1},
        {0, 1, 0, 1, 0},
        {1, 1, 1, 1, 1},
        {0, 0, 1, 0, 0},
        {0, 1, 0, 1, 0},
        {1, 0, 0, 0, 1},
    },
    {
        /* + */
        {0, 0, 0, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 1, 1, 1, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 0, 0, 0},
    },
    {
        /* , */
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 1, 0, 0, 0},
    },
    {
        /* - */
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 1, 1, 1, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
    },
    {
        /* . */
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 1, 1, 0, 0},
        {0, 1, 1, 0, 0},
    },
    {
        /* / */
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 1, 0, 0, 0},
    },
    {
        /* [ */
        {1, 1, 1, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {1, 1, 1, 0, 0},
    },
    {
        /* \ */
        {1, 0, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {0, 1, 0, 0, 0},
        {0, 1, 1, 0, 0},
        {0, 0, 1, 1, 0},
        {0, 0, 0, 1, 1},
        {0, 0, 0, 0, 1},
    },
    {
        /* ] */
        {0, 0, 1, 1, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 0, 1},
        {0, 0, 1, 1, 1},
    },
    {
        /* ^ */
        {0, 0, 1, 0, 0},
        {0, 1, 0, 1, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
    },
    {
        /* _ */
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {1, 1, 1, 1, 1},
    },
    {
        /* ` */
        {0, 0, 1, 0, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
    },
    {
        /* { */
        {0, 0, 1, 1, 0},
        {0, 1, 0, 0, 0},
        {0, 1, 0, 0, 0},
        {1, 0, 0, 0, 0},
        {0, 1, 0, 0, 0},
        {0, 1, 0, 0, 0},
        {0, 0, 1, 1, 0},
    },
    {
        /* | */
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
        {0, 0, 1, 0, 0},
    },
    {
        /* } */
        {0, 1, 1, 0, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 0, 1},
        {0, 0, 0, 1, 0},
        {0, 0, 0, 1, 0},
        {0, 1, 1, 0, 0},
    },
    {
        /* ~ */
        {0, 1, 0, 0, 1},
        {1, 0, 1, 0, 1},
        {1, 0, 0, 1, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0},
    }
};

static char *
getChar (int p_char)
{
  int       v_char = toupper (p_char);

  if (v_char >= 'A' && v_char <= 'Z')
    return &(g_alphaChars [(v_char-'A')] [0] [0]);

  if (p_char >= '0' && p_char <= '@')
    return &(g_numericChars [(v_char-'0')] [0] [0]);

  if (p_char >= '!' && p_char <= '/')
    return &(g_symbolicChars [(v_char-'!')] [0] [0]);

  if (p_char >= '[' && p_char <= '`')
    return &(g_symbolicChars [15+(v_char-'[')] [0] [0]);

  if (p_char >= '{' && p_char <= '~')
    return &(g_symbolicChars [19+(v_char-'{')] [0] [0]);

  return &(g_nullChar [0] [0]);
}

void
drawChar (SDL_Surface    *p_surfacePtr,
          char            p_char,
          int             p_x,
          int             p_y)
{
  int         v_x         = 0;
  int         v_y         = 0;
  int         v_xofs      = 0;
  int         v_yofs      = 0;
  size_t      v_w         = p_surfacePtr->w;
  char       *v_charPtr   = NULL;
  char       *v_pixelsPtr = (char *)p_surfacePtr->pixels;
      
  v_charPtr = getChar (p_char);

  if ((p_x + g_charWidth) < v_w)
  {
    /* draw the character  */
    for (v_y = 0;  v_y < g_charHeight; v_y++) 
    {
      for (v_x = 0; v_x < g_charWidth; v_x++)
      {
          v_pixelsPtr [((v_w*(p_y+v_y))+(p_x+v_x))] = 
            v_charPtr [(g_charWidth*v_y)+v_x];
      }
    }
  }

  return ;
}

static void
forEachChar (void (*p_routinePtr) (void *, const char *, int, int, int, int, int),
             void *p_userDataPtr,
             const char *p_text,
             int   p_x,
             int   p_y,
             int   p_charSpace)
{
  size_t  v_stringLength = strlen (p_text);
  size_t  v_i            = 0;

  int     v_x, v_y, v_xofs = 0, v_yofs = 0; 

  for (v_i = 0; v_i < v_stringLength; v_i++)
  {
      p_routinePtr (p_userDataPtr, 
                    p_text, 
                    v_i, 
                    p_x+v_xofs, 
                    p_y+v_yofs, 
                    g_charWidth, 
                    g_charHeight); 
      v_xofs += g_charWidth+p_charSpace;
  }
  return ; 
}

static void charCB (void *p_user,
                    const char *p_text,
                    int   p_offset, 
                    int   p_x, 
                    int   p_y, 
                    int   p_charWidth, 
                    int   p_charHeight)
{
  SDL_Surface *v_surfacePtr = (SDL_Surface *)p_user;
  drawChar (v_surfacePtr, p_text [p_offset], p_x, p_y);
  return ;
}

void
drawText (SDL_Surface *p_surfacePtr, 
          const char  *p_text, 
          int          p_x, 
          int          p_y, 
          int          p_charSpace)
{
  forEachChar (&charCB, 
               (void *)p_surfacePtr, 
               p_text,
               p_x, 
               p_y, 
               p_charSpace);
  return;
}

int
getCharHeight (void)
{
  return g_charHeight;
}

int
getCharWidth (void)
{
  return g_charWidth;
}

void
xorArea (SDL_Surface *p_surfacePtr, rectangle_t *p_rectPtr)
{
  int       v_x = 0;
  int       v_y = 0;
  int       v_w = 0;
  int       v_h = 0;
  int       v_i = 0;
  int       v_ii = 0;
  char     *v_pixelsPtr = NULL; 

  if (p_surfacePtr)
  {
    if (p_rectPtr)
    {
      v_w = p_rectPtr->width;
      v_h = p_rectPtr->height;
      v_x = p_rectPtr->position.x;
      v_y = p_rectPtr->position.y;
    }
    else
    {
      v_w = p_surfacePtr->w;
      v_h = p_surfacePtr->h;
    }

    v_pixelsPtr = (char *)p_surfacePtr->pixels;

    for (v_i = 0; (v_i) < v_h; v_i++)
    {
      for (v_ii = 0; (v_ii) < v_w; v_ii++)
      {
        v_pixelsPtr [((v_y+v_i)*p_surfacePtr->w)+(v_x+v_ii)] ^= 1;
      }
    }
    
  }
  return;
}

void posCharCB (void *p_user,
                const char *p_text,
                int   p_offset, 
                int   p_x, 
                int   p_y, 
                int   p_charWidth, 
                int   p_charHeight)
{
  posInd_t      *v_posInd = (posInd_t *)p_user;

  if (v_posInd->charOffset == p_offset)
  {
    v_posInd->rectanglePtr->position.x = p_x;
    v_posInd->rectanglePtr->position.y = p_y;
    v_posInd->rectanglePtr->width = p_charWidth;
    v_posInd->rectanglePtr->height = p_charHeight;
  }
}

rectangle_t *
getPosChar (rectangle_t *p_rect, 
            const char  *p_text, 
            int          p_x,
            int          p_y,
            int          p_charSpace,
            int          p_offset)
{
  posInd_t  v_posInd;

  if (p_rect)
  {
    p_rect->position.x = p_x;
    p_rect->position.y = p_y;
    p_rect->width = g_charWidth;
    p_rect->height = g_charHeight;

    v_posInd.rectanglePtr = p_rect;
    v_posInd.charOffset = p_offset;

    forEachChar (&posCharCB,
                 (void *)&v_posInd,
                 p_text,
                 p_x,
                 p_y,
                 p_charSpace);

    return p_rect;
  }
  return NULL;
}

/* cleaning up the macros */
#undef g_charWidth
#undef g_charHeight
